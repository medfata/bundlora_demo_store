{%- comment -%}
  Cart Discount Summary Snippet
  Displays applied discounts in cart (line-level and cart-level)
  
  Usage:
  {% render 'cart-discount-summary', cart: cart %}
  
  Bundlora Integration Ready:
  - Displays tiered discounts
  - Shows bundle savings
  - Supports automatic discount codes
  - Accessible with proper ARIA labels
{%- endcomment -%}

{%- liquid
  assign has_discounts = false
  assign total_savings = 0
  
  for item in cart.items
    if item.line_level_discount_allocations.size > 0
      assign has_discounts = true
      for discount in item.line_level_discount_allocations
        assign total_savings = total_savings | plus: discount.amount
      endfor
    endif
    
    if item.original_price != item.final_price
      assign item_savings = item.original_price | minus: item.final_price | times: item.quantity
      assign total_savings = total_savings | plus: item_savings
    endif
  endfor
  
  if cart.cart_level_discount_applications.size > 0
    assign has_discounts = true
    for discount in cart.cart_level_discount_applications
      assign total_savings = total_savings | plus: discount.total_allocated_amount
    endfor
  endif
-%}

{%- if has_discounts -%}
  <div class="cart-discount-summary" role="region" aria-label="{{ 'sections.cart.discounts_applied' | t | default: 'Discounts applied' }}">
    
    {%- comment -%} Cart-level discounts {%- endcomment -%}
    {%- if cart.cart_level_discount_applications.size > 0 -%}
      <ul class="cart-discount-summary__list list-unstyled" role="list">
        {%- for discount in cart.cart_level_discount_applications -%}
          <li class="cart-discount-summary__item">
            <span class="cart-discount-summary__icon" aria-hidden="true">
              {%- render 'icon-discount' -%}
            </span>
            <span class="cart-discount-summary__details">
              <span class="cart-discount-summary__title">{{ discount.title }}</span>
              <span class="cart-discount-summary__amount">-{{ discount.total_allocated_amount | money }}</span>
            </span>
          </li>
        {%- endfor -%}
      </ul>
    {%- endif -%}
    
    {%- comment -%} Total savings callout {%- endcomment -%}
    {%- if total_savings > 0 -%}
      <div class="cart-discount-summary__total">
        <span class="cart-discount-summary__total-label">
          {{ 'sections.cart.total_savings' | t | default: 'Total savings' }}
        </span>
        <span class="cart-discount-summary__total-amount">
          {{ total_savings | money }}
        </span>
      </div>
    {%- endif -%}
    
  </div>
{%- endif -%}

<style>
  .cart-discount-summary {
    margin: 1rem 0;
    padding: 1rem;
    background-color: rgba(var(--color-button), 0.05);
    border-radius: var(--inputs-radius);
  }
  
  .cart-discount-summary__list {
    margin: 0;
    padding: 0;
  }
  
  .cart-discount-summary__item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
  }
  
  .cart-discount-summary__item:not(:last-child) {
    border-bottom: 1px solid rgba(var(--color-foreground), 0.08);
  }
  
  .cart-discount-summary__icon svg {
    width: 1.6rem;
    height: 1.6rem;
    color: rgb(var(--color-button));
  }
  
  .cart-discount-summary__details {
    display: flex;
    justify-content: space-between;
    flex: 1;
    gap: 1rem;
  }
  
  .cart-discount-summary__title {
    font-weight: 500;
  }
  
  .cart-discount-summary__amount {
    color: rgb(var(--color-button));
    font-weight: 600;
  }
  
  .cart-discount-summary__total {
    display: flex;
    justify-content: space-between;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(var(--color-foreground), 0.1);
    font-weight: 600;
  }
  
  .cart-discount-summary__total-amount {
    color: rgb(var(--color-button));
  }
</style>